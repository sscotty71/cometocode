  # Pgbackrest copy specific files
  - name:  Adjust postgresql.conf for postgresql servers
    become: yes
    become_user: root
    template:
      src   : pgbackrest-templates/pgbackrest.pg.j2
      dest  : /etc/pgbackrest.conf
      owner : "{{ pg_backrest_user }}"
      group : "{{ pg_user }}"
      mode  : 0644

  - name:  Adjust postgresql.conf for postgresql servers
    become: yes
    become_user: root
    template:
      src   : pgbackrest-templates/include_pgbackrest.j2
      dest  : "{{ pg_conf_directory }}/pgbackrest.conf"
      owner : "{{ pg_user }}"
      group : "{{ pg_user }}"
      mode  : 0644

### Add to Postgresql.conf
  - name: Insert the pgbackrest.conf module on postgresql.conf file
    become: yes
    become_user: root
    lineinfile:
      path: "{{ pg_postgresql_conf_dir }}/postgresql.conf"
      line: include_if_exists 'conf.d/pgbackrest.conf'

# PostgreSQL restart
  - name: Restart postgresql
    become: yes
    become_user: root
    shell: service postgresql restart
    args:
     executable: /bin/bash
    tags: postgresql_restart
