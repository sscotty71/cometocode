  - name: pgbackrest.conf for postgresql server -2 
    become: yes
    become_user: root
    template:
     src:  "pg-pitr/pgbackrest.pg.j2"
     dest: "{{ path_pgbackrest_file_conf }}"
     owner: "{{ pg_backrest_user }}"
     group: "{{ pg_user }}"
     mode: '0644'
    tags:
      - pitr

  - name:  Adjust postgresql.conf for postgresql servers
    become: yes
    become_user: root
    template:
      src   : pg-pitr/include_pgbackrest.j2
      dest  : "{{ pg_conf_directory }}/pgbackrest.conf"
      owner : "{{ pg_user }}"
      group : "{{ pg_user }}"
      mode  : 0644
    tags:
      - pitr

### Add to Postgresql.conf
  - name: Insert the pgbackrest.conf module on postgresql.conf file
    become: yes
    become_user: root
    lineinfile:
      path: "{{ pg_postgresql_conf_dir }}/postgresql.conf"
      line: include_if_exists 'conf.d/pgbackrest.conf'
    tags:
      - pitr

# PostgreSQL restart
  - name: Restart postgresql
    become: yes
    become_user: root
    shell: service postgresql restart
    args:
     executable: /bin/bash
    tags: pitr
