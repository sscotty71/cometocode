# INSTALL MinIO

  - name: Install utilities
    become: yes
    become_user: root
    apt:
      pkg:
       - wget
      state: present
      update_cache: yes

#CREATE USER / GROUP 

  - name: Create the minio-user group
    become: yes
    become_user: root
    group:
      name: minio-user
      system: yes
      state: present

  - name: Create the minio-user user
    become: yes
    become_user: root
    user:
      name: minio-user
      group: minio-user
      system: yes
      create_home: no
      state: present


  - name: Make data directory
    become: yes
    become_user: root
    file:
      path: "{{ minio_data }}"
      owner: minio-user
      group: minio-user
      state: directory

  - name: Make .minio directory
    become: yes
    become_user: root
    file:
      path: "{{ minio_root_dir }}"
      owner: minio-user
      group: minio-user
      state: directory

  - name: Make certs directory
    become: yes
    become_user: root
    file:
      path: "{{ mioio_certs_dir }}"
      owner: minio-user
      group: minio-user
      state: directory
  
  - name: Copy private key
    become: yes
    become_user: root
    copy:
     owner: minio-user
     group: minio-user
     mode: 0644
     src: "./pg-minio/certs/private.key"
     dest: "{{ mioio_certs_dir }}/private.key"

  - name: Copy self signed certificate
    become: yes
    become_user: root
    copy:
     owner: minio-user
     group: minio-user
     mode: 0644
     src: "./pg-minio/certs/public.crt"
     dest: "{{ mioio_certs_dir }}/public.crt"

  - name: Install MinIO 
    become: yes
    become_user: root
    copy:
     owner: minio-user
     group: minio-user
     mode: 0755
     src: "./pg-minio/exe/minio"
     dest: "{{ mioio_exe_dir }}/minio"

## Conf from templates

  - name: Create minio.conf
    become: yes
    become_user: root
    template:
     src:  "pg-minio/conf/minio.conf.j2"
     dest: "{{ conf_mioio_conf_file }}"
#     owner: minio-user
#     group: minio-user
     mode: '0644'

## Service from templates

  - name: Create minio.service
    become: yes
    become_user: root
    template:
     src:  "pg-minio/service/minio.service.j2"
     dest: "{{ service_minio_filepath }}"
#     owner: minio-user
#     group: minio-user
     mode: '0644'